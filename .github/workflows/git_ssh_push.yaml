name: Sync to Pages Repository

on:
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

      # 4. 推送到目標倉庫
      - name: Push to Pages Repository
        env:

          TARGET_REPO: "git@github.com:AD-iOS/ad-ios.github.io.git"
          SOURCE_BRANCH: ${{ github.ref_name }}
        run: |
          # 添加遠程倉庫
          git remote add target "$TARGET_REPO"

          mkdir -p ~/.ssh
          ssh-keyscan github.com >> ~/.ssh/known_hosts
          
          echo "準備同步..."
          echo "源分支: $SOURCE_BRANCH"
          echo "目標: master"

          # 強制推送
          # 語法含義：把當前的 $SOURCE_BRANCH 推送到 target 的 master 分支
          git push target "$SOURCE_BRANCH:master" --force
          
          echo "同步成功！"